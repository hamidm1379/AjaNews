# ربات تلگرام - دریافت و ارسال خودکار پست‌ها

این ربات به صورت خودکار پست‌های جدید از 5 کانال تلگرامی را دریافت کرده و در کانال شما ارسال می‌کند. همچنین @username کانال‌های اصلی را با @username کانال شما جایگزین می‌کند.

## ویژگی‌ها

- ✅ دریافت خودکار پست‌های جدید از 5 کانال تلگرامی
- ✅ ارسال خودکار در کانال شما
- ✅ جایگزینی @username کانال‌های اصلی با @username شما
- ✅ پشتیبانی از پست‌های متنی و رسانه‌ای (عکس، ویدیو، فایل)
- ✅ ذخیره آخرین پست‌های دیده شده برای جلوگیری از ارسال مجدد

## پیش‌نیازها

- Python 3.8 یا بالاتر
- حساب تلگرام
- دسترسی به کانال‌های منبع (باید عضو کانال باشید)
- دسترسی مدیریتی به کانال هدف

## مراحل نصب و راه‌اندازی

### مرحله 1: دریافت API Credentials از تلگرام

1. به آدرس [https://my.telegram.org/apps](https://my.telegram.org/apps) بروید
2. وارد حساب تلگرام خود شوید
3. روی "Create new application" کلیک کنید
4. یک نام و توضیحات برای اپلیکیشن خود وارد کنید
5. `API_ID` و `API_HASH` را کپی کنید

### مرحله 2: نصب Python و کتابخانه‌ها

#### در Windows:
```bash
# نصب Python از python.org
# سپس در Command Prompt:
pip install -r requirements.txt
```

#### در Linux/Mac:
```bash
# نصب Python (اگر نصب نیست)
sudo apt update
sudo apt install python3 python3-pip  # برای Ubuntu/Debian
# یا
brew install python3  # برای Mac

# نصب کتابخانه‌ها
pip3 install -r requirements.txt
```

### مرحله 3: تنظیم فایل .env

1. فایل `env.example` را کپی کرده و نام آن را به `.env` تغییر دهید:

**در Windows:**
```bash
copy env.example .env
```

**در Linux/Mac:**
```bash
cp env.example .env
```

2. فایل `.env` را باز کرده و اطلاعات را وارد کنید:

```env
API_ID=12345678
API_HASH=abcdef1234567890abcdef1234567890
SESSION_NAME=bot_session
SOURCE_CHANNELS=@channel1,@channel2,@channel3,@channel4,@channel5
TARGET_CHANNEL=@mychannel
REPLACE_USERNAME=
NEW_USERNAME=@your_channel_username
```

**توضیحات:**
- `API_ID` و `API_HASH`: از مرحله 1 دریافت کنید
- `SOURCE_CHANNELS`: کانال‌های منبع را با کاما جدا کنید (با @ شروع شوند)
- `TARGET_CHANNEL`: کانال شما که پست‌ها در آن ارسال می‌شوند
- `REPLACE_USERNAME`: username های خاصی که باید جایگزین شوند (با کاما جدا کنید، مثل: `@old1,@old2,@old3`). اگر خالی بگذارید، همه @username ها جایگزین می‌شوند
- `NEW_USERNAME`: @username کانال شما که باید جایگزین شود

### مرحله 4: اجرای ربات

```bash
python app.py
```

در اولین اجرا، تلگرام از شما شماره تلفن و کد تأیید می‌خواهد. این اطلاعات فقط یک بار نیاز است و در فایل `bot_session.session` ذخیره می‌شود.

### مرحله 5: اطمینان از دسترسی‌ها

- مطمئن شوید که حساب شما عضو تمام کانال‌های منبع است
- مطمئن شوید که حساب شما دسترسی ارسال پیام در کانال هدف را دارد

## استقرار در سرور لیارا

### مرحله 1: آماده‌سازی پروژه

1. مطمئن شوید که فایل‌های زیر در پروژه شما هستند:
   - `app.py`
   - `requirements.txt`
   - `.env` (این فایل را در Git commit نکنید!)

2. ایجاد فایل `Procfile` برای لیارا:
```
worker: python app.py
```

3. ایجاد فایل `.gitignore`:
```
.env
*.session
*.session-journal
__pycache__/
*.pyc
last_messages.json
```

### مرحله 2: نصب Liara CLI

#### در Windows:
```bash
# دانلود از https://liara.ir/docs/cli/install
# یا با npm:
npm install -g @liara/cli
```

#### در Linux/Mac:
```bash
npm install -g @liara/cli
```

### مرحله 3: ورود به لیارا

```bash
liara login
```

### مرحله 4: ایجاد پروژه در لیارا

1. به پنل لیارا بروید: [https://console.liara.ir](https://console.liara.ir)
2. روی "ایجاد پروژه" کلیک کنید
3. نوع پروژه را "Worker" انتخاب کنید
4. نام پروژه را وارد کنید
5. منطقه (Region) را انتخاب کنید

### مرحله 5: تنظیم متغیرهای محیطی در لیارا

1. در پنل لیارا، به بخش "متغیرهای محیطی" بروید
2. متغیرهای زیر را اضافه کنید:

```
API_ID=12345678
API_HASH=abcdef1234567890abcdef1234567890
SESSION_NAME=bot_session
SOURCE_CHANNELS=@channel1,@channel2,@channel3,@channel4,@channel5
TARGET_CHANNEL=@mychannel
REPLACE_USERNAME=
NEW_USERNAME=@your_channel_username
```

### مرحله 6: استقرار پروژه

#### روش 1: با Git

1. پروژه خود را در GitLab/GitHub قرار دهید
2. در پنل لیارا:
   - به بخش "تنظیمات" بروید
   - "اتصال به Git" را فعال کنید
   - مخزن Git خود را متصل کنید
   - Branch را انتخاب کنید
   - روی "استقرار" کلیک کنید

#### روش 2: با CLI

```bash
# در دایرکتوری پروژه
liara deploy --app=your-app-name --platform=worker
```

### مرحله 7: تنظیم Worker در لیارا

1. در پنل لیارا، به بخش "Worker" بروید
2. مطمئن شوید که `Procfile` به درستی شناسایی شده است
3. Command را بررسی کنید: `python app.py`

### مرحله 8: فعال‌سازی ربات

1. بعد از استقرار، به بخش "لاگ‌ها" بروید
2. لاگ‌ها را بررسی کنید تا مطمئن شوید ربات به درستی اجرا شده است
3. در اولین اجرا، باید لاگ‌های مربوط به ورود تلگرام را ببینید

**نکته مهم:** در سرور لیارا، برای اولین بار که ربات اجرا می‌شود، نیاز به تأیید شماره تلفن دارید. برای این کار:

1. به بخش "Console" در پنل لیارا بروید
2. دستور زیر را اجرا کنید:
```bash
python app.py
```
3. شماره تلفن و کد تأیید را وارد کنید
4. فایل `bot_session.session` ایجاد می‌شود
5. این فایل را در Git commit کنید یا به صورت دستی در سرور قرار دهید

### مرحله 9: نگهداری و مانیتورینگ

- لاگ‌های ربات را به صورت منظم بررسی کنید
- در صورت بروز خطا، از بخش "لاگ‌ها" در پنل لیارا می‌توانید مشکل را بررسی کنید
- فایل `last_messages.json` به صورت خودکار ایجاد می‌شود و آخرین پست‌های دیده شده را ذخیره می‌کند

## عیب‌یابی

### مشکل: ربات پیام‌ها را دریافت نمی‌کند
- بررسی کنید که حساب شما عضو کانال‌های منبع است
- بررسی کنید که `SOURCE_CHANNELS` به درستی تنظیم شده است

### مشکل: ربات نمی‌تواند در کانال هدف پیام ارسال کند
- بررسی کنید که حساب شما دسترسی ارسال پیام در کانال هدف را دارد
- بررسی کنید که `TARGET_CHANNEL` به درستی تنظیم شده است

### مشکل: @username جایگزین نمی‌شود
- بررسی کنید که `NEW_USERNAME` به درستی تنظیم شده است
- مطمئن شوید که @username در ابتدای مقدار قرار دارد

### مشکل: در سرور لیارا ربات اجرا نمی‌شود
- بررسی کنید که `Procfile` به درستی ایجاد شده است
- بررسی کنید که تمام متغیرهای محیطی در لیارا تنظیم شده‌اند
- لاگ‌ها را بررسی کنید

## نکات مهم

- ⚠️ فایل `.env` را در Git commit نکنید (در `.gitignore` قرار دارد)
- ⚠️ فایل `*.session` حاوی اطلاعات احراز هویت شماست، آن را محرمانه نگه دارید
- ✅ ربات به صورت مداوم اجرا می‌شود و پیام‌های جدید را بررسی می‌کند
- ✅ در صورت قطع اتصال، ربات به صورت خودکار دوباره متصل می‌شود

## پشتیبانی

در صورت بروز مشکل، لاگ‌های ربات را بررسی کنید و خطاها را در Issues قرار دهید.

